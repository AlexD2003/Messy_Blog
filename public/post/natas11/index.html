<!DOCTYPE html>
<html lang="cn">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>My messy collection  | Natas-Level 11</title>
	<meta name="viewport" content="width=device-width,minimum-scale=1">
	<meta name="generator" content="Hugo 0.134.1">
	
	
	<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
	

	
	
	<link href="/dist/app.css" rel="stylesheet">
	

	

	
	
<link rel="shortcut icon" href="https://i.ibb.co/gRC4J2T/favicon-32x32.jpg" type="image/png" />


	

	
	
	
	
	
	



<link rel="stylesheet" href='//localhost:1313/lib/katex.min.css' crossorigin="anonymous">


<script defer src='//localhost:1313/lib/katex.min.js' crossorigin="anonymous"></script>


<script defer src='//localhost:1313/lib/contrib/auto-render.min.js'
crossorigin="anonymous"
onload='renderMathInElement(document.body);'></script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

	
	
	
	<script>
		(function (u, c) {
			var d = document,
				t = 'script',
				o = d.createElement(t),
				s = d.getElementsByTagName(t)[0];
			o.src = u;
			if (c) {
				o.addEventListener('load', function (e) {
					c(e);
				});
			}
			s.parentNode.insertBefore(o, s);
		})('\/\/localhost:1313\/lib\/pangu.min.js', function () {
			pangu.spacingPage();
		});
	</script>
	
	
	
	<style type="text/css" media="screen, print">
		@font-face {
			font-family: "FancyTitleFont";
			font-style: normal;
			font-display: swap;
			src: url('//localhost:1313/fonts/exampleFont.woff2') format('woff2'),
				url('//localhost:1313/fonts/exampleFont.woff') format('woff');
		}
		 
		  
		 
		@font-face {
			font-family: 'Noto Serif CJK SC';
			font-style: normal;
			font-weight: 300;
			font-display: swap;
			src: local('Noto Serif CJK SC Light'), local('NotoSerifCJK-Light'),
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff2') format('woff2'),
				 
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff') format('woff');
			 
		}

		 
		@font-face {
			font-family: 'Noto Serif CJK SC';
			font-style: normal;
			font-weight: 400;
			font-display: swap;
			src: local('Noto Serif CJK SC'), local('NotoSerifCJK-Regular'),
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff2') format('woff2'),
				 
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff') format('woff');
			 
		}

		 
		@font-face {
			font-family: 'Noto Serif CJK SC';
			font-style: normal;
			font-weight: 500;
			font-display: swap;
			src: local('Noto Serif CJK SC Medium'), local('NotoSerifCJK-Medium'),
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff2') format('woff2'),
				 
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff') format('woff');
			 
		}
	</style>
	
</head>

<body class="bg-gray-100 text-gray-700 font-sans">
	<div class="p-6 sm:p-10 md:p-16 flex flex-wrap">
		<header class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-1 md:order-1 max-w-2xl">
			<div
				class="z-50 bg-gray-100 bg-opacity-75 bg-opacity-custom lg:min-w-0.7 max-w-xl md:float-right md:text-right leading-loose tracking-tight md:sticky md:top-0 pt-2">
				
<div>
	<h2>
		<a href="/" title="My messy collection" class="heading font-cursive icon">My messy collection</a>
	</h2>
</div>
<h1 class="pt-2">Natas-Level 11</h1>

<h3 class="text-java-700 font-normal leading-relaxed pt-2">Writeup</h3>

<div class="flex flex-wrap justify-end pt-2 "><div class="md:flex-grow-0 font-light">
	
	
	
	
	<a class="post-taxonomy-category text-medium-red-violet-600 hover:text-medium-red-violet-400"
		href='/categories/overthewire'>Overthewire</a>&nbsp;&#47;
	
	<a class="post-taxonomy-category text-medium-red-violet-600 hover:text-medium-red-violet-400"
		href='/categories/natas'>Natas</a>
	
	
	

	
	&nbsp;&nbsp;
	

	
	
	
	
	<a class="post-taxonomy-tag text-eucalyptus-500"
		href='/tags/ctf'>CTF</a>&nbsp;&#47;
	
	<a class="post-taxonomy-tag text-eucalyptus-500"
		href='/tags/completed'>Completed</a>
	
	
	
</div><time class="text-eucalyptus-500 md:text-right md:flex-grow font-light pl-4"
		datetime="2024-08-21T11:56:21&#43;03:00">2024-8-21</time>
</div>

<hr />


			</div>
		</header>
		<main role="main" class="w-full md:w-3/5 xl:w-1/2 max-w-3xl order-2 md:order-2 min-h-70vh pt-2 pb-4">
			

<article>
	<section class="mx-auto content">
		<div class="c-rich-text"><h3 id="login">Login</h3>
<p><em>Username: natas11</em><br>
<em>Password: UJdqkK1pTu6VLt9UHWAgRZz6sVUZ3lEk</em><br>
<em>URL:      <a href="http://natas11.natas.labs.overthewire.org">http://natas11.natas.labs.overthewire.org</a></em></p>
<h3 id="solution-ideahttpswwwyoutubecomchrisdale"><a href="https://www.youtube.com/@ChrisDale">Solution Idea</a></h3>
<h3 id="tools">Tools</h3>
<p><a href="https://gchq.github.io/CyberChef/">CyberChef</a><br>
Very usefull site for encrypting and decrypting information.</p>
<h3 id="doc">Doc</h3>
<p><a href="https://docs.oracle.com/cd/E19047-01/sunscreen151/806-5397/i996724/index.html">What is encryption and decryption?</a><br>
Encryption is the process by which a readable message is converted to an unreadable form to prevent unauthorized parties from reading it. Decryption is the process of converting an encrypted message back to its original (readable) format. The original message is called the plaintext message. The encrypted message is called the ciphertext message.<br>
Digital encryption algorithms work by manipulating the digital content of a plaintext message mathematically, using an encryption algorithm and a digital key to produce a ciphertext version of the message. The sender and recipient can communicate securely if the sender and recipient are the only ones who know the key.<br>
<a href="https://en.wikipedia.org/wiki/XOR_cipher">What is XOR encryption?</a><br>
The XOR operator is extremely common as a component in more complex ciphers. By itself, using a constant repeating key, a simple XOR cipher can trivially be broken using frequency analysis. If the content of any message can be guessed or otherwise known then the key can be revealed. Its primary merit is that it is simple to implement, and that the XOR operation is computationally inexpensive. A simple repeating XOR (i.e. using the same key for xor operation on the whole data) cipher is therefore sometimes used for hiding information in cases where no particular security is required. The XOR cipher is often used in computer malware to make reverse engineering more difficult.<br>
<a href="https://policies.google.com/technologies/cookies?hl=en-US#:~:text=Cookies%20are%20small%20pieces%20of,site%20more%20useful%20to%20you.">What are cookies?üç™</a><br>
Cookies are small pieces of text sent to your browser by a website you visit. They help that website remember information about your visit, which can both make it easier to visit the site again and make the site more useful to you.
<strong>My bad drawing skills expressed on a whiteboard:</strong>
<img src="/img/natas/natas11-nustiusadesenez.jpeg" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br></p>
<h3 id="solution">Solution</h3>
<p>Let`s begin by taking a close look at the first page. We are promted with a display that reads : <strong>Cookies are protected with XOR encryption</strong> and a prompt to that allows us to set the color of the webpage background (See the cookie doc if you have not yet). In order for the user to not lose his changes to the color of the page, the site uses cookies to store that information. It is clearly stated that the cookie data is encrypted using XOR encryption.</p>
<img src="/img/natas/natas11-1.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
If you were to set the background color to any value including the default and take a look at what your browser stores about the page (<strong>Use inspect element</strong>) you will see something like this:
<img src="/img/natas/natas11-2.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
Same stuff again, we have the source code listed in the right of the prompt. Let`s take a look at what happens behind the courtain and try to understand the code.
<strong>Code in question:</strong>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">html</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">head</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- This stuff in the header has nothing to do with the level --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">link</span> <span style="color:#75af00">rel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;stylesheet&#34;</span> <span style="color:#75af00">type</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;text/css&#34;</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/css/level.css&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">link</span> <span style="color:#75af00">rel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;stylesheet&#34;</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/css/jquery-ui.css&#34;</span> <span style="color:#111">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">link</span> <span style="color:#75af00">rel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;stylesheet&#34;</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/css/wechall.css&#34;</span> <span style="color:#111">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/js/jquery-1.9.1.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/js/jquery-ui.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">http://natas.labs.overthewire.org/js/wechall-data.js</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/js/wechall.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span><span style="color:#00a8c8">var</span> <span style="color:#75af00">wechallinfo</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span> <span style="color:#d88200">&#34;level&#34;</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#34;natas11&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;pass&#34;</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#34;&lt;censored&gt;&#34;</span> <span style="color:#111">};&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">head</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">$defaultdata = array( &#34;showpassword&#34;=&gt;&#34;no&#34;, &#34;bgcolor&#34;=&gt;&#34;#ffffff&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function xor_encrypt($in) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $key = &#39;&lt;censored&gt;&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $text = $in;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $outText = &#39;&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // Iterate through each character
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    for($i=0;$i&lt;strlen($text);$i++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $outText .= $text[$i] ^ $key[$i % strlen($key)];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return $outText;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function loadData($def) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    global $_COOKIE;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $mydata = $def;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if(array_key_exists(&#34;data&#34;, $_COOKIE)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $tempdata = json_decode(xor_encrypt(base64_decode($_COOKIE[&#34;data&#34;])), true);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if(is_array($tempdata) &amp;&amp; array_key_exists(&#34;showpassword&#34;, $tempdata) &amp;&amp; array_key_exists(&#34;bgcolor&#34;, $tempdata)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        if (preg_match(&#39;/^#(?:[a-f\d]{6})$/i&#39;, $tempdata[&#39;bgcolor&#39;])) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        $mydata[&#39;showpassword&#39;] = $tempdata[&#39;showpassword&#39;];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        $mydata[&#39;bgcolor&#39;] = $tempdata[&#39;bgcolor&#39;];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return $mydata;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function saveData($d) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    setcookie(&#34;data&#34;, base64_encode(xor_encrypt(json_encode($d))));
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">$data = loadData($defaultdata);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">if(array_key_exists(&#34;bgcolor&#34;,$_REQUEST)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if (preg_match(&#39;/^#(?:[a-f\d]{6})$/i&#39;, $_REQUEST[&#39;bgcolor&#39;])) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        $data[&#39;bgcolor&#39;] = $_REQUEST[&#39;bgcolor&#39;];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">saveData($data);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">h1</span><span style="color:#111">&gt;</span>natas11<span style="color:#111">&lt;/</span><span style="color:#f92672">h1</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">div</span> <span style="color:#75af00">id</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;content&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">body</span> <span style="color:#75af00">style</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;background: &lt;?=$data[&#39;bgcolor&#39;]?&gt;;&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span>Cookies are protected with XOR encryption<span style="color:#111">&lt;</span><span style="color:#f92672">br</span><span style="color:#111">/&gt;&lt;</span><span style="color:#f92672">br</span><span style="color:#111">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">if($data[&#34;showpassword&#34;] == &#34;yes&#34;) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    print &#34;The password for natas12 is &lt;censored&gt;&lt;br&gt;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">form</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span>Background color: <span style="color:#111">&lt;</span><span style="color:#f92672">input</span> <span style="color:#75af00">name</span><span style="color:#f92672">=</span><span style="color:#d88200">bgcolor</span> <span style="color:#75af00">value</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;&lt;?=$data[&#39;bgcolor&#39;]?&gt;&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">input</span> <span style="color:#75af00">type</span><span style="color:#f92672">=</span><span style="color:#d88200">submit</span> <span style="color:#75af00">value</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;Set color&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">form</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">div</span> <span style="color:#75af00">id</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;viewsource&#34;</span><span style="color:#111">&gt;&lt;</span><span style="color:#f92672">a</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;index-source.html&#34;</span><span style="color:#111">&gt;</span>View sourcecode<span style="color:#111">&lt;/</span><span style="color:#f92672">a</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">div</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">div</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">body</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">html</span><span style="color:#111">&gt;</span></span></span></code></pre></div>
<p>Since this time, the code is pretty convoluted and not intuitive, we will brake it down in segments.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>$defaultdata = array(&#34;showpassword&#34; =&gt; &#34;no&#34;, &#34;bgcolor&#34; =&gt; &#34;#ffffff&#34;);</span></span></code></pre></div>
<p>It begins by defining a default array, <strong>$defaultdata</strong>, including 2 key pairs <strong>showpassword</strong>, <strong>bgcolor</strong> with values <strong>no</strong> and <strong>#ffffff</strong> respectively.</p>
<pre tabindex="0"><code>function xor_encrypt($in) {
    $key = &#39;&lt;censored&gt;&#39;;
    $text = $in;
    $outText = &#39;&#39;;

    // Iterate through each character
    for($i=0; $i&lt;strlen($text); $i++) {
        $outText .= $text[$i] ^ $key[$i % strlen($key)];
    }

    return $outText;
}
</code></pre><p>This is where the magic happens, it is the function that outputs the result after the application of <strong>XOR encryption</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>function loadData($def) {
</span></span><span style="display:flex;"><span>    global $_COOKIE;
</span></span><span style="display:flex;"><span>    $mydata = $def;
</span></span><span style="display:flex;"><span>    if(array_key_exists(&#34;data&#34;, $_COOKIE)) {
</span></span><span style="display:flex;"><span>        $tempdata = json_decode(xor_encrypt(base64_decode($_COOKIE[&#34;data&#34;])), true);
</span></span><span style="display:flex;"><span>        if(is_array($tempdata) <span style="color:#960050;background-color:#1e0010">&amp;&amp;</span> array_key_exists(&#34;showpassword&#34;, $tempdata) <span style="color:#960050;background-color:#1e0010">&amp;&amp;</span> array_key_exists(&#34;bgcolor&#34;, $tempdata)) {
</span></span><span style="display:flex;"><span>            if (preg_match(&#39;/^#(?:[a-f\d]{6})$/i&#39;, $tempdata[&#39;bgcolor&#39;])) {
</span></span><span style="display:flex;"><span>                $mydata[&#39;showpassword&#39;] = $tempdata[&#39;showpassword&#39;];
</span></span><span style="display:flex;"><span>                $mydata[&#39;bgcolor&#39;] = $tempdata[&#39;bgcolor&#39;];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    return $mydata;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>The loadData function firstly initializes the variable <strong>$myData</strong> with default values and checks if the cookie exists. Afterwards, the script decodes the information from Base64, decrypts it using the <strong>xor_encrypt</strong> function and then decodes the resulting json. Remember this process, it will be usefull. The rest of the code is basic data and function validation.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>function saveData($d) {
</span></span><span style="display:flex;"><span>    setcookie(&#34;data&#34;, base64_encode(xor_encrypt(json_encode($d))));
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This function stores the given array into a cookieüç™.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>$data = loadData($defaultdata);</span></span></code></pre></div>
<p>Basic populating function.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>if(array_key_exists(&#34;bgcolor&#34;, $_REQUEST)) {
</span></span><span style="display:flex;"><span>    if (preg_match(&#39;/^#(?:[a-f\d]{6})$/i&#39;, $_REQUEST[&#39;bgcolor&#39;])) {
</span></span><span style="display:flex;"><span>        $data[&#39;bgcolor&#39;] = $_REQUEST[&#39;bgcolor&#39;];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And finally, this is the background color handling function.<br>
Enough with analizing what happens, let`s try to solve this level.<br>
Firstly, I will run the json encoding function on the default data in a php compiler in order to see what the initial array looks like in json.<br>
<img src="/img/natas/natas11-3.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
The output of the function is the array : <strong>{&ldquo;showpassword&rdquo;:&ldquo;no&rdquo;,&ldquo;bgcolor&rdquo;:&quot;#ffffff&quot;}</strong>.
Remember the cookie from earlier? This is the step where it comes in. Using the <strong>CyberChef</strong> website, I will firstly apply URL decoding on the cookie value (to convert URL specific values to their numeric values) and then apply the steps present in the code in reverse order.<br>
Now that we have the decoded cookie and we have the output (the json format array) we could find the key since in XOR decryption, knowing 2 values out of the {initial,key,result} gives you access to finding the 3rd unknown value (look at my drawing).</p>
<img src="/img/natas/natas11-5.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
Now all there`s left to do since we found a repeating key is get a new cookie coming from the array that has the <strong>no</strong> value changed to <strong>yes</strong>.
<img src="/img/natas/natas11-6.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
By changing the cookie value with the value we got after this process should pass to the program the modified string and grant us access to the next level.
<img src="/img/natas/natas11-7.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
Of course, a way simpler sollution would be reversing the encryption script in your own php file and running it to use the array values of your choice and it will spit out the correct cookie, but where`s the fun in that? :)
</div>
	</section>


</article>

		</main>
		<div class="w-full h-0 flex-none order-3"></div>
		<aside role="contentinfo"
			class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-4 md:order-3 md:sticky md:bottom-0 self-end max-w-2xl">
			<div class="md:float-right md:text-right leading-loose tracking-tight md:mb-2">
				
	<div class="md:max-w-xs  flex flex-col md:items-end">
	<ul class="font-serif flex-grow-0 flex justify-between flex-wrap md:flex-col">
	
	
	<li class="px-1 md:px-0">
		<a href="/post/" title="Posts page" 
			class="font-medium text-medium-red-violet-600 hover:text-medium-red-violet-400" >
			Posts
		</a>
	</li>
	
	<li class="px-1 md:px-0">
		<a href="/categories/" title="Categories page" >
			Categories
		</a>
	</li>
	
	<li class="px-1 md:px-0">
		<a href="/tags/" title="Tags page" >
			Tags
		</a>
	</li>
	
	<li class="px-1 md:px-0">
		<a href="/about/aboutme/" title="About me page" >
			About me
		</a>
	</li>
	
	
	
	
	<div id="fastSearch" class="m-0">
		<input id="searchInput" type="text" size=10 
			class="bg-gray-100 focus:outline-none border-b border-gray-100 focus:border-eucalyptus-300 md:text-right
			placeholder-java-500 min-w-0 max-w-xxxs"
			placeholder="search" />
		<ul id="searchResults" class="bg-gray-200 px-2 divide-y divide-gray-400">
		</ul>
	</div>
	
</ul>
	

<div class="flex flex-wrap-reverse md:justify-end content-end md:content-start justify-start items-start   max-h-16">
	
	
	<a href='https://github.com/AlexD2003' target="_blank" class="github icon pl-1 text-eucalyptus-400 hover:text-java-400" title="github link" rel="noopener"
		aria-label="follow on github‚Äî‚ÄîOpens in a new window">
		
		<div class="fill-current h-8 w-8">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <g>
        <path fill="none" d="M0 0h24v24H0z"/>
        <path fill-rule="nonzero" d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32 0 0 1-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 0 1 .676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 0 1 .63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731 0 0 1 12 3.315c.912 0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 0 1 .616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293 0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492 0 0 1-.012 2.716 1 1 0 0 1-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998 0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66 0-.955-.312-1.744-.913-2.404a1 1 0 0 1-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 0 1-.833.135A9.626 9.626 0 0 0 12 5.315c-.89 0-1.772.119-2.592.35a1 1 0 0 1-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 0 1-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 0 1-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/>
    </g>
</svg>

		</div>
	</a>
	
	
	
	<a href='https://www.instagram.com/alex_domnit/' target="_blank" class="instagram icon pl-1 text-eucalyptus-400 hover:text-java-400" title="instagram link" rel="noopener"
		aria-label="follow on instagram‚Äî‚ÄîOpens in a new window">
		
		<div class="fill-current h-8 w-8">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <g>
        <path fill="none" d="M0 0h24v24H0z"/>
        <path fill-rule="nonzero" d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm0-2a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm6.5-.25a1.25 1.25 0 0 1-2.5 0 1.25 1.25 0 0 1 2.5 0zM12 4c-2.474 0-2.878.007-4.029.058-.784.037-1.31.142-1.798.332-.434.168-.747.369-1.08.703a2.89 2.89 0 0 0-.704 1.08c-.19.49-.295 1.015-.331 1.798C4.006 9.075 4 9.461 4 12c0 2.474.007 2.878.058 4.029.037.783.142 1.31.331 1.797.17.435.37.748.702 1.08.337.336.65.537 1.08.703.494.191 1.02.297 1.8.333C9.075 19.994 9.461 20 12 20c2.474 0 2.878-.007 4.029-.058.782-.037 1.309-.142 1.797-.331.433-.169.748-.37 1.08-.702.337-.337.538-.65.704-1.08.19-.493.296-1.02.332-1.8.052-1.104.058-1.49.058-4.029 0-2.474-.007-2.878-.058-4.029-.037-.782-.142-1.31-.332-1.798a2.911 2.911 0 0 0-.703-1.08 2.884 2.884 0 0 0-1.08-.704c-.49-.19-1.016-.295-1.798-.331C14.925 4.006 14.539 4 12 4zm0-2c2.717 0 3.056.01 4.122.06 1.065.05 1.79.217 2.428.465.66.254 1.216.598 1.772 1.153a4.908 4.908 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428.047 1.066.06 1.405.06 4.122 0 2.717-.01 3.056-.06 4.122-.05 1.065-.218 1.79-.465 2.428a4.883 4.883 0 0 1-1.153 1.772 4.915 4.915 0 0 1-1.772 1.153c-.637.247-1.363.415-2.428.465-1.066.047-1.405.06-4.122.06-2.717 0-3.056-.01-4.122-.06-1.065-.05-1.79-.218-2.428-.465a4.89 4.89 0 0 1-1.772-1.153 4.904 4.904 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.013 15.056 2 14.717 2 12c0-2.717.01-3.056.06-4.122.05-1.066.217-1.79.465-2.428a4.88 4.88 0 0 1 1.153-1.772A4.897 4.897 0 0 1 5.45 2.525c.638-.248 1.362-.415 2.428-.465C8.944 2.013 9.283 2 12 2z"/>
    </g>
</svg>

		</div>
	</a>
	
	
	
	<a href='mailto:alexandru.domnit@stud.ubbcluj.ro' target="_blank" class="mail icon pl-1 text-eucalyptus-400 hover:text-java-400" title="mail link" rel="noopener"
		aria-label="follow on mail‚Äî‚ÄîOpens in a new window">
		
		<div class="fill-current h-8 w-8">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <g>
        <path fill="none" d="M0 0h24v24H0z"/>
        <path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm17 4.238l-7.928 7.1L4 7.216V19h16V7.238zM4.511 5l7.55 6.662L19.502 5H4.511z"/>
    </g>
</svg>
		</div>
	</a>
	
	
</div>

	<div class="text-sm text-gray-500 leading-tight a-gray">
		
		<br />
		1119 words in this page.
	</div>
</div>

			</div>
		</aside>
		<footer class="w-full md:w-3/5 xl:w-1/2 order-3 max-w-3xl md:order-4 pt-2">
			
<hr class="double-line" />
<div class="flex flex-wrap justify-between pb-2 leading-loose font-serif">
    
    <a class="flex-grow-0" href="/post/natas10/">
        <svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24">
            <path fill="none" d="M0 0h24v24H0z" />
            <path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" /></svg>
        Natas-Level 10
    </a>
    
    
    <a class="flex-grow-0" href="/post/natas12/">
        Natas-Level 12
        <svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24">
            <path fill="none" d="M0 0h24v24H0z" />
            <path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" /></svg></a>
    
</div>
<div >



<div class="font-serif pb-2 flex align-start leading-loose">
	<span class="heading pr-6 leading-loose">Related</span>
	<span >
		
			<a href="/post/natas10/">Natas-Level 10</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas9/">Natas-Level 9</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas8/">Natas-Level 8</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas7/">Natas-Level 7</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas6/">Natas-Level 6</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas5/">Natas-Level 5</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas4/">Natas-Level 4</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas3/">Natas-Level 3</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas2/">Natas-Level 2</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas1/">Natas-Level 1</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas0/">Natas-Level 0</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/bandit32/">Bandit-Level 32</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/bandit31/">Bandit-Level 31</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/bandit30/">Bandit-Level 30</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/bandit29/">Bandit-Level 29</a>
		
</span>
</div>

</div>
<div class="pb-2">
    
</div>

		</footer>
		

<script src="/dist/app.js"></script>


<script src="/lib/fuse.min.js"></script> 
<script src="/lib/fastsearch.js"></script>

	</div>
</body>

</html>
