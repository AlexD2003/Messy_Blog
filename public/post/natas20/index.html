<!DOCTYPE html>
<html lang="cn">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>My messy collection  | Natas-Level 20</title>
	<meta name="viewport" content="width=device-width,minimum-scale=1">
	<meta name="generator" content="Hugo 0.135.0">
	
	
	<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
	

	
	
	<link href="/dist/app.css" rel="stylesheet">
	

	

	
	
<link rel="shortcut icon" href="https://i.ibb.co/gRC4J2T/favicon-32x32.jpg" type="image/png" />


	

	
	
	
	
	
	



<link rel="stylesheet" href='//localhost:1313/lib/katex.min.css' crossorigin="anonymous">


<script defer src='//localhost:1313/lib/katex.min.js' crossorigin="anonymous"></script>


<script defer src='//localhost:1313/lib/contrib/auto-render.min.js'
crossorigin="anonymous"
onload='renderMathInElement(document.body);'></script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

	
	
	
	<script>
		(function (u, c) {
			var d = document,
				t = 'script',
				o = d.createElement(t),
				s = d.getElementsByTagName(t)[0];
			o.src = u;
			if (c) {
				o.addEventListener('load', function (e) {
					c(e);
				});
			}
			s.parentNode.insertBefore(o, s);
		})('\/\/localhost:1313\/lib\/pangu.min.js', function () {
			pangu.spacingPage();
		});
	</script>
	
	
	
	<style type="text/css" media="screen, print">
		@font-face {
			font-family: "FancyTitleFont";
			font-style: normal;
			font-display: swap;
			src: url('//localhost:1313/fonts/exampleFont.woff2') format('woff2'),
				url('//localhost:1313/fonts/exampleFont.woff') format('woff');
		}
		 
		  
		 
		@font-face {
			font-family: 'Noto Serif CJK SC';
			font-style: normal;
			font-weight: 300;
			font-display: swap;
			src: local('Noto Serif CJK SC Light'), local('NotoSerifCJK-Light'),
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff2') format('woff2'),
				 
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff') format('woff');
			 
		}

		 
		@font-face {
			font-family: 'Noto Serif CJK SC';
			font-style: normal;
			font-weight: 400;
			font-display: swap;
			src: local('Noto Serif CJK SC'), local('NotoSerifCJK-Regular'),
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff2') format('woff2'),
				 
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff') format('woff');
			 
		}

		 
		@font-face {
			font-family: 'Noto Serif CJK SC';
			font-style: normal;
			font-weight: 500;
			font-display: swap;
			src: local('Noto Serif CJK SC Medium'), local('NotoSerifCJK-Medium'),
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff2') format('woff2'),
				 
				url('//localhost:1313/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff') format('woff');
			 
		}
	</style>
	
</head>

<body class="bg-gray-100 text-gray-700 font-sans">
	<div class="p-6 sm:p-10 md:p-16 flex flex-wrap">
		<header class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-1 md:order-1 max-w-2xl">
			<div
				class="z-50 bg-gray-100 bg-opacity-75 bg-opacity-custom lg:min-w-0.7 max-w-xl md:float-right md:text-right leading-loose tracking-tight md:sticky md:top-0 pt-2">
				
<div>
	<h2>
		<a href="/" title="My messy collection" class="heading font-cursive icon">My messy collection</a>
	</h2>
</div>
<h1 class="pt-2">Natas-Level 20</h1>

<h3 class="text-java-700 font-normal leading-relaxed pt-2">Writeup</h3>

<div class="flex flex-wrap justify-end pt-2 "><div class="md:flex-grow-0 font-light">
	
	
	
	
	<a class="post-taxonomy-category text-medium-red-violet-600 hover:text-medium-red-violet-400"
		href='/categories/overthewire'>Overthewire</a>&nbsp;&#47;
	
	<a class="post-taxonomy-category text-medium-red-violet-600 hover:text-medium-red-violet-400"
		href='/categories/natas'>Natas</a>
	
	
	

	
	&nbsp;&nbsp;
	

	
	
	
	
	<a class="post-taxonomy-tag text-eucalyptus-500"
		href='/tags/ctf'>CTF</a>&nbsp;&#47;
	
	<a class="post-taxonomy-tag text-eucalyptus-500"
		href='/tags/completed'>Completed</a>
	
	
	
</div><time class="text-eucalyptus-500 md:text-right md:flex-grow font-light pl-4"
		datetime="2024-09-10T11:59:40&#43;03:00">2024-9-10</time>
</div>

<hr />


			</div>
		</header>
		<main role="main" class="w-full md:w-3/5 xl:w-1/2 max-w-3xl order-2 md:order-2 min-h-70vh pt-2 pb-4">
			

<article>
	<section class="mx-auto content">
		<div class="c-rich-text"><h3 id="login">Login</h3>
<p><em>Username: natas20</em><br>
<em>Password: p5mCvP7GS2K6Bmt3gqhM2Fc1A5T8MVyw</em><br>
<em>URL:      <a href="http://natas20.natas.labs.overthewire.org">http://natas20.natas.labs.overthewire.org</a></em></p>
<h3 id="doc">Doc</h3>
<p>Burp Suite is a proprietary software tool for security assessment and penetration testing of web applications. It software was initially developed in 2003-2006 by Dafydd Stuttard to automate his own security testing needs, after realizing the capabilities of automatable web tools like Selenium.
<a href="https://en.wikipedia.org/wiki/Burp_Suite">Source.</a><br>
Burp Suite tutorial and usefull guides:<br>
<a href="https://portswigger.net/burp/documentation/desktop/getting-started">Port Swigger.</a></p>
<h3 id="solution">Solution</h3>
<p>The index page of <strong>natas 20</strong> gives a quick prompt of <strong>You are logged in as a regular user. Login as an admin to retrieve credentials for natas21</strong>. It is the same premise as for <strong>natas 19</strong>.</p>
<img src="/img/natas/natas20-1.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
<p>Let`s look at the source code :</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">html</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">head</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- This stuff in the header has nothing to do with the level --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">link</span> <span style="color:#75af00">rel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;stylesheet&#34;</span> <span style="color:#75af00">type</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;text/css&#34;</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/css/level.css&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">link</span> <span style="color:#75af00">rel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;stylesheet&#34;</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/css/jquery-ui.css&#34;</span> <span style="color:#111">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">link</span> <span style="color:#75af00">rel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;stylesheet&#34;</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/css/wechall.css&#34;</span> <span style="color:#111">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/js/jquery-1.9.1.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/js/jquery-ui.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">http://natas.labs.overthewire.org/js/wechall-data.js</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;&lt;</span><span style="color:#f92672">script</span> <span style="color:#75af00">src</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://natas.labs.overthewire.org/js/wechall.js&#34;</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">script</span><span style="color:#111">&gt;</span><span style="color:#00a8c8">var</span> <span style="color:#75af00">wechallinfo</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span> <span style="color:#d88200">&#34;level&#34;</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#34;natas20&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;pass&#34;</span><span style="color:#f92672">:</span> <span style="color:#d88200">&#34;&lt;censored&gt;&#34;</span> <span style="color:#111">};&lt;/</span><span style="color:#f92672">script</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">head</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">body</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">h1</span><span style="color:#111">&gt;</span>natas20<span style="color:#111">&lt;/</span><span style="color:#f92672">h1</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">div</span> <span style="color:#75af00">id</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;content&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;?php
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function debug($msg) { /* {{{ */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if(array_key_exists(&#34;debug&#34;, $_GET)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        print &#34;DEBUG: $msg&lt;br&gt;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* }}} */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function print_credentials() { /* {{{ */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if($_SESSION and array_key_exists(&#34;admin&#34;, $_SESSION) and $_SESSION[&#34;admin&#34;] == 1) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    print &#34;You are an admin. The credentials for the next level are:&lt;br&gt;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    print &#34;&lt;pre&gt;Username: natas21\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    print &#34;Password: &lt;censored&gt;&lt;/pre&gt;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    } else {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    print &#34;You are logged in as a regular user. Login as an admin to retrieve credentials for natas21.&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* }}} */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* we don&#39;t need this */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function myopen($path, $name) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    //debug(&#34;MYOPEN $path $name&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* we don&#39;t need this */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function myclose() {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    //debug(&#34;MYCLOSE&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function myread($sid) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;MYREAD $sid&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if(strspn($sid, &#34;1234567890qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM-&#34;) != strlen($sid)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;Invalid SID&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        return &#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $filename = session_save_path() . &#34;/&#34; . &#34;mysess_&#34; . $sid;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if(!file_exists($filename)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        debug(&#34;Session file doesn&#39;t exist&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        return &#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;Reading from &#34;. $filename);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $data = file_get_contents($filename);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $_SESSION = array();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    foreach(explode(&#34;\n&#34;, $data) as $line) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        debug(&#34;Read [$line]&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $parts = explode(&#34; &#34;, $line, 2);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if($parts[0] != &#34;&#34;) $_SESSION[$parts[0]] = $parts[1];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return session_encode() ?: &#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function mywrite($sid, $data) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // $data contains the serialized version of $_SESSION
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // but our encoding is better
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;MYWRITE $sid $data&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // make sure the sid is alnum only!!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if(strspn($sid, &#34;1234567890qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM-&#34;) != strlen($sid)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;Invalid SID&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        return;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $filename = session_save_path() . &#34;/&#34; . &#34;mysess_&#34; . $sid;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $data = &#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;Saving in &#34;. $filename);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    ksort($_SESSION);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    foreach($_SESSION as $key =&gt; $value) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        debug(&#34;$key =&gt; $value&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        $data .= &#34;$key $value\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    file_put_contents($filename, $data);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    chmod($filename, 0600);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* we don&#39;t need this */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function mydestroy($sid) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    //debug(&#34;MYDESTROY $sid&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* we don&#39;t need this */
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">function mygarbage($t) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    //debug(&#34;MYGARBAGE $t&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    return true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">session_set_save_handler(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34;myopen&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34;myclose&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34;myread&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34;mywrite&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34;mydestroy&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &#34;mygarbage&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">session_start();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">if(array_key_exists(&#34;name&#34;, $_REQUEST)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $_SESSION[&#34;name&#34;] = $_REQUEST[&#34;name&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    debug(&#34;Name set to &#34; . $_REQUEST[&#34;name&#34;]);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">print_credentials();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">$name = &#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">if(array_key_exists(&#34;name&#34;, $_SESSION)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    $name = $_SESSION[&#34;name&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">form</span> <span style="color:#75af00">action</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;index.php&#34;</span> <span style="color:#75af00">method</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;POST&#34;</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span>Your name: <span style="color:#111">&lt;</span><span style="color:#f92672">input</span> <span style="color:#75af00">name</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;name&#34;</span> <span style="color:#75af00">value</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;&lt;?=$name?&gt;&#34;</span><span style="color:#111">&gt;&lt;</span><span style="color:#f92672">br</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">input</span> <span style="color:#75af00">type</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;submit&#34;</span> <span style="color:#75af00">value</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;Change name&#34;</span> <span style="color:#111">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">form</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;</span><span style="color:#f92672">div</span> <span style="color:#75af00">id</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;viewsource&#34;</span><span style="color:#111">&gt;&lt;</span><span style="color:#f92672">a</span> <span style="color:#75af00">href</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;index-source.html&#34;</span><span style="color:#111">&gt;</span>View sourcecode<span style="color:#111">&lt;/</span><span style="color:#f92672">a</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">div</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">div</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">body</span><span style="color:#111">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">&lt;/</span><span style="color:#f92672">html</span><span style="color:#111">&gt;</span></span></span></code></pre></div>
<h4 id="code-breakdown-into-sections">Code breakdown into sections</h4>
<p><strong>The debug function</strong> checks the URL for a debug parameter. It is usually used to aid in development. This will come in handy.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>function debug($msg) {
</span></span><span style="display:flex;"><span>    if(array_key_exists(&#34;debug&#34;, $_GET)) {
</span></span><span style="display:flex;"><span>        print &#34;DEBUG: $msg<span style="color:#111">&lt;</span><span style="color:#f92672">br</span><span style="color:#111">&gt;</span>&#34;;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>The print credentials function</strong> checks the <strong>$_SESSION</strong> array in order to see if the admin flag of the session is set to 1.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>function print_credentials() {
</span></span><span style="display:flex;"><span>    if($_SESSION and array_key_exists(&#34;admin&#34;, $_SESSION) and $_SESSION[&#34;admin&#34;] == 1) {
</span></span><span style="display:flex;"><span>        print &#34;You are an admin. The credentials for the next level are:<span style="color:#111">&lt;</span><span style="color:#f92672">br</span><span style="color:#111">&gt;</span>&#34;;
</span></span><span style="display:flex;"><span>        print &#34;<span style="color:#111">&lt;</span><span style="color:#f92672">pre</span><span style="color:#111">&gt;</span>Username: natas21\n&#34;;
</span></span><span style="display:flex;"><span>        print &#34;Password: <span style="color:#111">&lt;</span><span style="color:#f92672">censored</span><span style="color:#111">&gt;&lt;/</span><span style="color:#f92672">pre</span><span style="color:#111">&gt;</span>&#34;;
</span></span><span style="display:flex;"><span>    } else {
</span></span><span style="display:flex;"><span>        print &#34;You are logged in as a regular user. Login as an admin to retrieve credentials for natas21.&#34;;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This is really all of the code that can be considered of interest in our vulnerability purpose. The easiest way to exploit this would be session tampering.</p>
<img src="/img/natas/natas20-2.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
Using the debug parameter in the url as mentioned previously, you can can see that the session file it tries to load doesn`t exist even tho this page actually reads. This seems to be the debug session for the default session. As done previously, we can intercept the packet we want to send in order to alter it`s contents.
<img src="/img/natas/natas20-3.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
<h4 id="burp-">Burp :</h4>
<img src="/img/natas/natas20-4.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
<p>Press <strong>Ctrl+R</strong> to redirect the packet into the repeater in order to be able to modify the contents of the header and keep sending the modified packet at the same time as you are getting a http response for analysis.<br>
The header data should be <strong>%0Aadmin 1</strong> which is the URL encoded version of <strong>admin \n 1</strong>. This solution has been used before.</p>
<img src="/img/natas/natas20-5.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
<p>Now just try sending the modified header and watch the response.</p>
<img src="/img/natas/natas20-6.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
<p>That solved it.<br>
<strong>Password : </strong>BPhv63cKE1lkQl04cE5CuFTzXe15NfiH<br>
Now letting the proxy through, you can also see the respons on the webpage.</p>
<img src="/img/natas/natas20-7.png" alt="gif" style="display: block; margin-left: auto; margin-right: auto;">
<br>
</div>
	</section>


</article>

		</main>
		<div class="w-full h-0 flex-none order-3"></div>
		<aside role="contentinfo"
			class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-4 md:order-3 md:sticky md:bottom-0 self-end max-w-2xl">
			<div class="md:float-right md:text-right leading-loose tracking-tight md:mb-2">
				
	<div class="md:max-w-xs  flex flex-col md:items-end">
	<ul class="font-serif flex-grow-0 flex justify-between flex-wrap md:flex-col">
	
	
	<li class="px-1 md:px-0">
		<a href="/post/" title="Posts page" 
			class="font-medium text-medium-red-violet-600 hover:text-medium-red-violet-400" >
			Posts
		</a>
	</li>
	
	<li class="px-1 md:px-0">
		<a href="/categories/" title="Categories page" >
			Categories
		</a>
	</li>
	
	<li class="px-1 md:px-0">
		<a href="/tags/" title="Tags page" >
			Tags
		</a>
	</li>
	
	<li class="px-1 md:px-0">
		<a href="/about/aboutme/" title="About me page" >
			About me
		</a>
	</li>
	
	
	
	
	<div id="fastSearch" class="m-0">
		<input id="searchInput" type="text" size=10 
			class="bg-gray-100 focus:outline-none border-b border-gray-100 focus:border-eucalyptus-300 md:text-right
			placeholder-java-500 min-w-0 max-w-xxxs"
			placeholder="search" />
		<ul id="searchResults" class="bg-gray-200 px-2 divide-y divide-gray-400">
		</ul>
	</div>
	
</ul>
	

<div class="flex flex-wrap-reverse md:justify-end content-end md:content-start justify-start items-start   max-h-16">
	
	
	<a href='https://github.com/AlexD2003' target="_blank" class="github icon pl-1 text-eucalyptus-400 hover:text-java-400" title="github link" rel="noopener"
		aria-label="follow on github——Opens in a new window">
		
		<div class="fill-current h-8 w-8">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <g>
        <path fill="none" d="M0 0h24v24H0z"/>
        <path fill-rule="nonzero" d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32 0 0 1-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 0 1 .676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 0 1 .63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731 0 0 1 12 3.315c.912 0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 0 1 .616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293 0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492 0 0 1-.012 2.716 1 1 0 0 1-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998 0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66 0-.955-.312-1.744-.913-2.404a1 1 0 0 1-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 0 1-.833.135A9.626 9.626 0 0 0 12 5.315c-.89 0-1.772.119-2.592.35a1 1 0 0 1-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 0 1-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 0 1-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/>
    </g>
</svg>

		</div>
	</a>
	
	
	
	<a href='https://www.instagram.com/alex_domnit/' target="_blank" class="instagram icon pl-1 text-eucalyptus-400 hover:text-java-400" title="instagram link" rel="noopener"
		aria-label="follow on instagram——Opens in a new window">
		
		<div class="fill-current h-8 w-8">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <g>
        <path fill="none" d="M0 0h24v24H0z"/>
        <path fill-rule="nonzero" d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm0-2a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm6.5-.25a1.25 1.25 0 0 1-2.5 0 1.25 1.25 0 0 1 2.5 0zM12 4c-2.474 0-2.878.007-4.029.058-.784.037-1.31.142-1.798.332-.434.168-.747.369-1.08.703a2.89 2.89 0 0 0-.704 1.08c-.19.49-.295 1.015-.331 1.798C4.006 9.075 4 9.461 4 12c0 2.474.007 2.878.058 4.029.037.783.142 1.31.331 1.797.17.435.37.748.702 1.08.337.336.65.537 1.08.703.494.191 1.02.297 1.8.333C9.075 19.994 9.461 20 12 20c2.474 0 2.878-.007 4.029-.058.782-.037 1.309-.142 1.797-.331.433-.169.748-.37 1.08-.702.337-.337.538-.65.704-1.08.19-.493.296-1.02.332-1.8.052-1.104.058-1.49.058-4.029 0-2.474-.007-2.878-.058-4.029-.037-.782-.142-1.31-.332-1.798a2.911 2.911 0 0 0-.703-1.08 2.884 2.884 0 0 0-1.08-.704c-.49-.19-1.016-.295-1.798-.331C14.925 4.006 14.539 4 12 4zm0-2c2.717 0 3.056.01 4.122.06 1.065.05 1.79.217 2.428.465.66.254 1.216.598 1.772 1.153a4.908 4.908 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428.047 1.066.06 1.405.06 4.122 0 2.717-.01 3.056-.06 4.122-.05 1.065-.218 1.79-.465 2.428a4.883 4.883 0 0 1-1.153 1.772 4.915 4.915 0 0 1-1.772 1.153c-.637.247-1.363.415-2.428.465-1.066.047-1.405.06-4.122.06-2.717 0-3.056-.01-4.122-.06-1.065-.05-1.79-.218-2.428-.465a4.89 4.89 0 0 1-1.772-1.153 4.904 4.904 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.013 15.056 2 14.717 2 12c0-2.717.01-3.056.06-4.122.05-1.066.217-1.79.465-2.428a4.88 4.88 0 0 1 1.153-1.772A4.897 4.897 0 0 1 5.45 2.525c.638-.248 1.362-.415 2.428-.465C8.944 2.013 9.283 2 12 2z"/>
    </g>
</svg>

		</div>
	</a>
	
	
	
	<a href='mailto:alexandru.domnit@stud.ubbcluj.ro' target="_blank" class="mail icon pl-1 text-eucalyptus-400 hover:text-java-400" title="mail link" rel="noopener"
		aria-label="follow on mail——Opens in a new window">
		
		<div class="fill-current h-8 w-8">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <g>
        <path fill="none" d="M0 0h24v24H0z"/>
        <path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm17 4.238l-7.928 7.1L4 7.216V19h16V7.238zM4.511 5l7.55 6.662L19.502 5H4.511z"/>
    </g>
</svg>
		</div>
	</a>
	
	
</div>

	<div class="text-sm text-gray-500 leading-tight a-gray">
		
		<br />
		781 words in this page.
	</div>
</div>

			</div>
		</aside>
		<footer class="w-full md:w-3/5 xl:w-1/2 order-3 max-w-3xl md:order-4 pt-2">
			
<hr class="double-line" />
<div class="flex flex-wrap justify-between pb-2 leading-loose font-serif">
    
    <a class="flex-grow-0" href="/post/tecknoworks_challange/">
        <svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24">
            <path fill="none" d="M0 0h24v24H0z" />
            <path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" /></svg>
        Tecknoworks-Intenship challange
    </a>
    
    
    <a class="flex-grow-0" href="/post/natas21/">
        Natas-Level 21
        <svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24">
            <path fill="none" d="M0 0h24v24H0z" />
            <path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" /></svg></a>
    
</div>
<div >



<div class="font-serif pb-2 flex align-start leading-loose">
	<span class="heading pr-6 leading-loose">Related</span>
	<span >
		
			<a href="/post/natas19/">Natas-Level 19</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas18/">Natas-Level 18</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas17/">Natas-Level 17</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas16/">Natas-Level 16</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas15/">Natas-Level 15</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas14/">Natas-Level 14</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas13/">Natas-Level 13</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas12/">Natas-Level 12</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas11/">Natas-Level 11</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas10/">Natas-Level 10</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas9/">Natas-Level 9</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas8/">Natas-Level 8</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas7/">Natas-Level 7</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas6/">Natas-Level 6</a>&nbsp;&nbsp;&#47;&nbsp;
		
			<a href="/post/natas5/">Natas-Level 5</a>
		
</span>
</div>

</div>
<div class="pb-2">
    
</div>

		</footer>
		

<script src="/dist/app.js"></script>


<script src="/lib/fuse.min.js"></script> 
<script src="/lib/fastsearch.js"></script>

	</div>
</body>

</html>
